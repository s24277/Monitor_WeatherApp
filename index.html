<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prognoza pogody</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
</head>
<body class="bg-cover bg-center" style="background-image: url('weatherman.png');">

  <div class="grid grid-cols-5 grid-rows-7 h-screen w-screen gap-1">
    
    <!-- city input -->
    <div class="row-start-1 row-end-2 col-start-1 col-end-6 flex items-center justify-center gap-4 p-2">
     <button class="city-btn bg-blue-500 text-white font-semibold rounded-1g px-4 py-2 hover:bg-blue-600 transition" data-city="Warszawa">Warszawa</button>
     <button class="city-btn bg-blue-500 text-white font-semibold rounded-1g px-4 py-2 hover:bg-blue-600 transition" data-city="GdaÅ„sk">GdaÅ„sk</button>
     <button class="city-btn bg-blue-500 text-white font-semibold rounded-1g px-4 py-2 hover:bg-blue-600 transition" data-city="KrakÃ³w">KrakÃ³w</button>
     <button class="city-btn bg-blue-500 text-white font-semibold rounded-1g px-4 py-2 hover:bg-blue-600 transition" data-city="WrocÅ‚aw">WrocÅ‚aw</button>
     <button class="city-btn bg-blue-500 text-white font-semibold rounded-1g px-4 py-2 hover:bg-blue-600 transition" data-city="PoznaÅ„">PoznaÅ„</button>
    </div>

    <!-- current data panel -->
    <div id="current-panel" class="row-start-2 row-end-3 col-start-1 col-end-2 bg-blue-200 flex flex-col items-center justify-center rounded-xl shadow p-2 text-blue-900 font-semibold">
      <p class="text-lg">Aktualnie</p>
      <p id="location-name" class="text-xl mt-1">--</p>
      <p id="current-temp" class="text-2xl mt-2">--Â°C</p>
      <p id="current-desc" class="text-md mt-1">--</p>
    </div>

    <!-- panels: today, tomorrow, day after tomorrow -->
    <div class="row-start-4 row-end-5 col-start-1 col-end-6 flex items-center justify-center gap-4">
      <div class="bg-yellow-200 rounded-xl shadow-lg w-1/5 h-3/4 flex flex-col items-center justify-center p-2">
        <p class="font-semibold text-gray-700">DziÅ›</p>
        <p id="avg-today" class="text-2xl font-bold text-blue-600">--Â°C</p>
        <p id="desc-today" class="text-sm text-gray-600">--</p>
      </div>
      <div class="bg-yellow-200 rounded-xl shadow-lg w-1/5 h-3/4 flex flex-col items-center justify-center p-2">
        <p class="font-semibold text-gray-700">Jutro</p>
        <p id="avg-tomorrow" class="text-2xl font-bold text-blue-600">--Â°C</p>
        <p id="desc-tomorrow" class="text-sm text-gray-600">--</p>
      </div>
      <div class="bg-yellow-200 rounded-xl shadow-lg w-1/5 h-3/4 flex flex-col items-center justify-center p-2">
        <p class="font-semibold text-gray-700">Pojutrze</p>
        <p id="avg-dayafter" class="text-2xl font-bold text-blue-600">--Â°C</p>
        <p id="desc-dayafter" class="text-sm text-gray-600">--</p>
      </div>
    </div>

    <!-- chart -->
    <div class="row-start-5 row-end-7 col-start-1 col-end-6 flex items-center justify-center">
      <div class="bg-white rounded-xl shadow-lg w-full h-full p-2">
        <canvas id="myChart" class="w-full h-full"></canvas>
      </div>
    </div>
  </div>

<script>
const ctx = document.getElementById('myChart').getContext('2d');
const avgTodayEl = document.getElementById('avg-today');
const avgTomorrowEl = document.getElementById('avg-tomorrow');
const avgDayAfterEl = document.getElementById('avg-dayafter');
const currentTempEl = document.getElementById('current-temp');
const currentDescEl = document.getElementById('current-desc');
const locationNameEl = document.getElementById('location-name');
let myChart;

// map of cities in Poland
const polishCities = {
  "Warszawa": { lat: 52.23, lon: 21.01 },
  "KrakÃ³w": { lat: 50.06, lon: 19.94 },
  "GdaÅ„sk": { lat: 54.35, lon: 18.65 },
  "WrocÅ‚aw": { lat: 51.11, lon: 17.03 },
  "PoznaÅ„": { lat: 52.41, lon: 16.93 }
};

// mapping weather codes to description
const weatherDescriptions = {
  0: "SÅ‚onecznie â˜€ï¸",
  1: "GÅ‚Ã³wnie sÅ‚onecznie ðŸŒ¤ï¸",
  2: "CzÄ™Å›ciowo pochmurno â›…",
  3: "Pochmurno â˜ï¸",
  45: "MgÅ‚a ðŸŒ«ï¸",
  48: "MarznÄ…ca mgÅ‚a â„ï¸",
  51: "MÅ¼awka ðŸŒ¦ï¸",
  61: "Deszcz ðŸŒ§ï¸",
  63: "Silny deszcz ðŸŒ§ï¸",
  71: "Åšnieg â„ï¸",
  80: "Przelotne opady ðŸŒ¦ï¸",
  95: "Burze â›ˆï¸"
};

// function to fetch and draw weather chart
function fetchWeather(lat, lon, cityName) {
  locationNameEl.textContent = cityName;

  fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,precipitation,weathercode&timezone=Europe%2FWarsaw`)
    .then(res => res.json())
    .then(data => {
      const times = data.hourly.time.map(t => new Date(t));
      const temps = data.hourly.temperature_2m;
      const weatherCodes = data.hourly.weathercode;
      const now = new Date();

      const dayGroups = {};
      const weatherGroups = {};
      times.forEach((time, i) => {
        const key = time.toISOString().split('T')[0];
        if (!dayGroups[key]) {
          dayGroups[key] = [];
          weatherGroups[key] = [];
        }
        dayGroups[key].push(temps[i]);
        weatherGroups[key].push(weatherCodes[i]);
      });

      const days = Object.keys(dayGroups).slice(0, 3);
      const averages = days.map(day => {
        const arr = dayGroups[day];
        return (arr.reduce((a, b) => a + b, 0) / arr.length).toFixed(1);
      });

      const mode = arr => arr.sort((a,b) =>
        arr.filter(v => v===a).length - arr.filter(v => v===b).length
      ).pop();

      const descs = days.map(day => weatherDescriptions[mode(weatherGroups[day])] || "--");

      avgTodayEl.textContent = `${averages[0]}Â°C`;
      avgTomorrowEl.textContent = `${averages[1]}Â°C`;
      avgDayAfterEl.textContent = `${averages[2]}Â°C`;
      document.getElementById('desc-today').textContent = descs[0];
      document.getElementById('desc-tomorrow').textContent = descs[1];
      document.getElementById('desc-dayafter').textContent = descs[2];

      const currentIndex = times.findIndex(t => t.getHours() === now.getHours());
      if (currentIndex !== -1) {
        currentTempEl.textContent = `${temps[currentIndex].toFixed(1)}Â°C`;
        currentDescEl.textContent = weatherDescriptions[weatherCodes[currentIndex]] || "--";
      }

      const hours = times.slice(0, 24).map(t => t.getHours());
      const chartTemps = temps.slice(0, 24);

      if (myChart) {
        myChart.destroy(); 
      }

    
      myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: hours,
          datasets: [{
            label: 'Temperatura (Â°C)',
            data: chartTemps,
            borderColor: "rgba(0,123,255,0.8)",
            backgroundColor: "rgba(0,123,255,0.1)",
            pointRadius: 3,
            borderWidth: 2,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            datalabels: {
              align: 'top',
              anchor: 'end',
              color: '#000',
              font: { weight: 'bold' },
              formatter: value => value + 'Â°C'
            },
            legend: { display: false },
            title: {
              display: true,
              text: `Prognoza temperatury dla ${cityName}`,
              font: { size: 18 }
            }
          },
          scales: {
            y: {
              title: { display: true, text: 'Temperatura (Â°C)' },
              suggestedMin: Math.min(...chartTemps) - 2,
              suggestedMax: Math.max(...chartTemps) + 3
            },
            x: { title: { display: true, text: 'Godzina' } }
          }
        },
        plugins: [ChartDataLabels]
      });
    })
    .catch(err => console.error("BÅ‚Ä…d pobierania danych:", err));
}



// buttons for city
document.querySelectorAll('.city-btn').forEach(btn => {
btn.addEventListener('click', () => {
  const city = btn.dataset.city;
  const coords = polishCities[city];
  fetchWeather(coords.lat, coords.lon, city);
});
});

//Default
fetchWeather(polishCities["GdaÅ„sk"].lat, polishCities["GdaÅ„sk"].lon, "GdaÅ„sk");

</script>
</body>
</html>
